<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title># Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) | cjlee38</title><meta name=keywords content="null"><meta name=description content="0. 들어가며 : 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 &ldquo;시간표 추천 시스템&rdquo; 이었다.
본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 &ldquo;남는 시간에, 이걸 듣는건 어때?&rdquo; 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.
그 과정에서, &ldquo;비즈니스프로그래밍2&rdquo; 수업에서 배웠던 &ldquo;연관규칙&#34;을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.
1. 연관규칙이란? : 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 &ldquo;맥주를 사는 사람은 대개 기저귀도 같이 산다&rdquo;(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라) 라는 이야기를 들어본 적이 있을 것이다."><meta name=author content="cjlee38"><link rel=canonical href=http://cjlee38.github.io/post/data/data_mining/2020-08-30-association_rule_with_java/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://cjlee38.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://cjlee38.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://cjlee38.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://cjlee38.github.io/apple-touch-icon.png><link rel=mask-icon href=http://cjlee38.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="# Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )"><meta property="og:description" content="0. 들어가며 : 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 &ldquo;시간표 추천 시스템&rdquo; 이었다.
본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 &ldquo;남는 시간에, 이걸 듣는건 어때?&rdquo; 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.
그 과정에서, &ldquo;비즈니스프로그래밍2&rdquo; 수업에서 배웠던 &ldquo;연관규칙&#34;을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.
1. 연관규칙이란? : 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 &ldquo;맥주를 사는 사람은 대개 기저귀도 같이 산다&rdquo;(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라) 라는 이야기를 들어본 적이 있을 것이다."><meta property="og:type" content="article"><meta property="og:url" content="http://cjlee38.github.io/post/data/data_mining/2020-08-30-association_rule_with_java/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-08-30T22:31:00+00:00"><meta property="article:modified_time" content="2020-08-30T22:31:00+00:00"><meta property="og:site_name" content="cjlee38"><meta name=twitter:card content="summary"><meta name=twitter:title content="# Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )"><meta name=twitter:description content="0. 들어가며 : 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 &ldquo;시간표 추천 시스템&rdquo; 이었다.
본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 &ldquo;남는 시간에, 이걸 듣는건 어때?&rdquo; 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.
그 과정에서, &ldquo;비즈니스프로그래밍2&rdquo; 수업에서 배웠던 &ldquo;연관규칙&#34;을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.
1. 연관규칙이란? : 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 &ldquo;맥주를 사는 사람은 대개 기저귀도 같이 산다&rdquo;(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라) 라는 이야기를 들어본 적이 있을 것이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://cjlee38.github.io/post/"},{"@type":"ListItem","position":2,"name":"# Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )","item":"http://cjlee38.github.io/post/data/data_mining/2020-08-30-association_rule_with_java/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"# Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )","name":"# Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )","description":"0. 들어가며 : 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 \u0026ldquo;시간표 추천 시스템\u0026rdquo; 이었다.\n본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 \u0026ldquo;남는 시간에, 이걸 듣는건 어때?\u0026rdquo; 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.\n그 과정에서, \u0026ldquo;비즈니스프로그래밍2\u0026rdquo; 수업에서 배웠던 \u0026ldquo;연관규칙\u0026quot;을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.\n1. 연관규칙이란? : 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 \u0026ldquo;맥주를 사는 사람은 대개 기저귀도 같이 산다\u0026rdquo;(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라) 라는 이야기를 들어본 적이 있을 것이다.","keywords":["null"],"articleBody":"0. 들어가며 : 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 “시간표 추천 시스템” 이었다.\n본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 “남는 시간에, 이걸 듣는건 어때?” 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.\n그 과정에서, “비즈니스프로그래밍2” 수업에서 배웠던 “연관규칙\"을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.\n1. 연관규칙이란? : 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 “맥주를 사는 사람은 대개 기저귀도 같이 산다”(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라) 라는 이야기를 들어본 적이 있을 것이다.\n전혀 연관이 없어 보이는 두 item이 왜 자주 같이 등장하는가? 를 살펴봤더니, 퇴근한 아빠가 집에서 아이를 돌보던 엄마로부터 “기저귀좀 사와라” 라는 말에 마트를 들리면서, 겸사겸사 맥주도 한 캔 산다는 이야기다.\n즉, “하나의 item을 샀을 때, 다른 item이 얼마나 자주 등장하는가?” 를 다루는게 연관규칙 분석이다.\n조금 어려운 말로는, “연관규칙은 데이터베이스에서 Transaction(거래)의 동시출현성향에 대한 관계성을 표현한다” 고 한다.\n  Note. Transaction 이란?\nTransaction이란 “하나의 거래\"를 의미한다. 위 예시에서는, “맥주와 기저귀를 구매한 이력\"이 된다.\n달리 말하면, 하나의 영수증이 Transaction이 된다.\n  2. 연관규칙의 평가척도 : 그렇다면, 단순하게 “A를 샀을 때, B가 자주 등장한다” 면, 이를 무조건 연관지어서 생각할 수 있을까? 이를 평가하는 방법에는 여러가지가 있을 것이다.\n이를 찾아보면 정말 다양한 분석 기법이 있지만, 이번 포스팅에서는 이 평가 척도를 “지지도(Support), 신뢰도(Confidence), 향상도(Lift)” 의 세가지만 다룬다.\n1) 지지도(Support) : 먼저, 지지도란 물건 X와 Y가 있을 때, **“X와 Y가 동시에 등장하는 비율”**을 의미한다. 가령, 전체 거래수가 1,000 건인데, 이 중에서 X와 Y가 동시에 등장하는 횟수가 200이라면, Support는 20%, 즉 0.2 가 된다.\n따라서, Support의 범위는 0 부터 1까지가 된다.\n  Note 1. 간혹, Support를 “단순등장횟수\"로, 즉 위 예시라면 200으로 표현하는 경우도 있긴 한데, 이는 비즈니스 전문가가 판단할 영역이라고 본다.\n그러나, 내가 진행하는 시간표 추천 시스템은 새로이 제작하는 시스템이고, 이 이용자의 수를 측정할 수 없기 때문에, 전체 Transaction 수로 나누어주었다.\n   Note 2. “다른 물건과의 비교\"가 필요한 다른 평가 척도와 달리, Support는 단독으로 측정될 수도 있다.\n즉, 물건 X에 대한 Support, 물건 Y에 대한 Support를 따로 구할 수 있다.\n  2) 신뢰도(Confidence) : 다음으로, 신뢰도란, 물건 X와 Y가 있을 때, “X를 구매한 Transaction 중, Y가 얼마나 포함되는가?” 를 이야기 한다.\n즉, 전체 Transaction이 1,000 건인데, X를 구매한 Transaction이 200건이고, 이 중 Y가 포함된 거래가 100건이라면, 100/200 인 0.5가 된다.\n따라서, Support와 마찬가지로 Range는 0부터 1까지가 된다.\n  Note. 위와 같이 “X를 구매했을 때, Y를 얼마나 구매한다.” 라고 할 때,\n“X를 구매했을 때” 부분을 조건절(Antecedent)\n“Y를 얼마나 구매한다” 부분을 결과절(Consequent) 이라고 칭한다.\n  3) 향상도(Lift) : 마지막으로 향상도란, 물건 X와 Y가 있을 때, “Y가 없을 때 X를 구매한 횟수 vs Y가 있을 때 X를 구매한 횟수” 가 된다. 팀원은 이를 기울기로 비유했다.\n마찬가지로, 전체 Transaction이 1,000 건인데, X를 구매한 Transaction이 200건, Y를 구매한 Transaction이 400건이라고 해보자.\n이 때, Y를 구매했을 때 X가 50건, Y를 구매하지 않았을 때 X가 150건이라면,\n((50/1000) / (200/1000) * (400/1000)) = (0.05 / 0.08) = 0.625가 된다.\n따라서, Lift 값이 1이라는 것은 서로 연관이 없다는 것을 의미한다.\n이를 수식으로 표현하면 다음과 같다.\n{: .alignCenter}\n이러한 평가 척도는 비즈니스 전문가가 이를 섞어서 사용한다. 즉, 상황에 맞춰서 여러 평가척도를 결합하여 활용해야 한다는 것이다.\n가령, 무조건 신뢰도가 높은 itemset만을 활용한다면, 전체 Transaction에서 얼마 등장하지도 않은(극단적으로, 한 번만 등장한) itemset에 대해서 유의미하다고 판단할 것이다.\n혹은, 높은 지지도, 낮은 신뢰도의 itemset에 집중하는 것이, 낮은 지지도, 높은 신뢰도의 itemset에 집중하는 것 보다 더욱 높은 수익을 안겨줄 수도 있다.\n3. Apriori Algorithm 1) Assocation Rule as Vanilla : 위와 같이 평가척도가 존재하는 것을 알았다. 그렇다면, 이에 대해서 연관규칙을 분석 하려면 얼마나 많은 경우의 수가 생길까?\n가령, 다루고 있는 item이 A,B,C,D의 4개가 있다고 해보자. 그러면, 이에 대한 집합은\nLevel 1. [(A),(B),(C),(D)] – 4개\nLevel 2. [(A,B), (A,C), (A,D), (B,C), (B,D), (C,D)] – 6개\nLevel 3. [(A,B,C), (A,B,D), (A,C,D), (B,C,D)] – 4개\nLevel 4. [(A,B,C,D)] – 1개\n총 15개, 즉 24-1 개가 생긴다. 다루고 있는 item이 10개만 되더라도 210-1 , 즉 1023개가 생긴다.\n  Note. (A), (B), (C) … (A,B,C,D)와 같은 집합을, 연관규칙에선 항목집합(Itemset) 이라고 부른다.\n  또한, 이 Itemset들에 대한 연관규칙을 분석하는 것도 상당히 많다.\n가령, (A,B,C) 라는 항목집합에 대해서 Confidence를 구한다고 생각해보자.\n조건절 A \u0026 결과절 B,C\n조건절 B \u0026 결과절 A,C\n조건절 C \u0026 결과절 A,B\n즉, A를 구매했을 때, B,C 가 같이 구매될 확률을 구하는 것이다.\n앞서, 2n-1 개의 경우의 수에, 위와 같은 경우의 수가 추가된다면, 이를 계산하는 것은 대단한 미친짓이다.\n여기를 참고하면, 이러한 Rule의 개수는 3n-2n+1+1 개가 된다고 한다.\n2) Association Rule with Apriori Algorithm : 위와 같은 참사가 발생하는 것을 막기 위해, Apriori Algorithm이 고안되었다.\n  Note 1. 연관규칙에서, 연산을 줄이는 전략은 Apriori Algorithm뿐만이 아니라, FP-growth, DHP 등의 다른 알고리즘이 있다. 그러나, Apriori의 장점은, 구현하기가 용이하고, 다른 사람에게 설명하기 좋다는 장점이 있다.\n   Note 2. Apriori Algorithm과 Association Rule을 동일시하는 글도 본 적이 있는데, 내가 봤을 때에는 엄연히 다르다. Association Rule은 여러 평가 척도를 기반으로 한 분석 기법이고, Apriori는 Association Rule의 비효율성을 방지하기 위한 Algorithm이다.\n  이 알고리즘은 “한 항목이 비빈발(infrequent)집합이라면, 이 항목집합(subset)을 포함하는 모든 항목집합(superset)은 비빈발 항목집합이다” 라는 원칙을 갖고 있다.\n무슨말이냐 하면, 위와 같은 A,B,C,D 의 예시에서, 만약 (A) 라는 Itemset이 자주 등장하지 않는다면, 이 (A) 를 포함하는 Itemset[ (A,B), (A,C) … (A,B,C,D) ]은 쳐다보지도 않는 것이다.\n또한, (A)와 같은 단일항목집합에만 해당하는 것이 아니고, (A,B)와 같은 여러개의 item을 포함하고 있는 Itemset에서 출발할 수도 있다.\n그렇다면, 비빈발(infrequent)의 기준은 어떻게 정할까? 이 또한 비즈니스 전문가가 정한다. 이를 “최소지지도” 라 한다. (어찌보면, 도메인 지식을 갖고 있는 사람이 이 기준을 정하는 것은 당연하기도 하다.)\n그러나, “통상적” 으로, 0.5를 기준으로 둔다고 “카더라.”\n따라서, Apriori 알고리즘의 순서는 다음과 같다.\n 최소 지지도는 0.5 이다. Level.1의 Itemset[(A),(B),(C),(D)]를 만든다. (이를 C1 이라 한다.) Level.1 에서, 최소지지도를 만족하지 못하는 Itemset을 쳐낸다. 여기선, A와 B가 살아남았다고 해보자. 다음으로, 살아남은 녀석들에 대한 Level.2 의 Itemset [(A,B), (A,C), (A,D), (B,C), (B,D)] 를 만든다. (C2) Level.2에서, 최소지지도를 만족하지 못하는 Itemset을 쳐낸다. Level이 item의 개수(A,B,C,D의 4개)가 될 때까지 계속해서 반복.  이를 그림으로 표현하면 다음과 같다.\n{: .alignCenter}\n사진 출처\n위 그림에서, 우리가 앞으로 “연관규칙분석 할 대상\"은 L1, L2, L3 이다.\n4. 코드로 구현해보자. : 자바에 익숙치 않아, 클래스 설계를 이렇게 하는 것이 맞는지는 모르겠다.\nApriori.java\nimport com.google.common.collect.Sets; import java.util.*;  /** * Apriori Algorithm implementation * @author cjlee * @see cjlee38.github.io */ public class Apriori {  /** * Example : * * Set transactions = getTransactions(); // superset : set of transactions, subset : set of items * Float minSupport = (float) 0.5; * Apriori apriori = new Apriori(minSupport, transactions) * apriori.run(); */  private Float minSupport;  private SetSetString dataset;  private MapSetString, Float result;   public Apriori(Float minSupport, SetSetString dataset) {  this.minSupport = minSupport;  this.dataset = dataset;  this.result = new HashMap();  }  public MapSetString, Float getResult() {  return result;  }   public void run() {  SetString itemset = createSet(dataset);  Integer level = 1;  Integer maxLevel = itemset.size();   while (level  maxLevel) {  SetSetString combinations = getCombinations(itemset, level);  MapSetString, Float supportedItemset = getSupportedItemset(combinations);  result.putAll(supportedItemset);  itemset = createSet(supportedItemset.keySet());  level++;  if (itemset.size()  1) { // means current itemsets are all pruned  break;  }  }   }   public SetSetString getCombinations(SetString set, Integer level) {  return Sets.combinations(set, level);  }   // 중복없는 데이터를 구하는 함수  public SetString createSet(SetSetString data) {  SetString set = new HashSet();  for (SetString transaction : data) {  for ( String item : transaction) {  set.add(item);  }  }  return set;  }   public Float calcSupport(SetString itemset) {  Integer occurence = 0;  for( SetString transaction : dataset) {  if (transaction.containsAll(itemset)) {  occurence++;  }  }  return occurence / ((float)dataset.size());  }   public MapSetString, Float getSupportedItemset(SetSetString itemset) {  MapSetString, Float map = new HashMap();  for (SetString comb : itemset) {  Float support = calcSupport(comb);  if (support  minSupport) {  map.put(comb, support)  }  }   return map;  } } AssociationRule.java\n import com.google.common.collect.Sets; import java.util.*;   /* * 참고문헌 * Association Rule implementation * @author cjlee * @see cjlee38.github.io * @refer 김용, Apriori 알고리즘 기반의 개인화 정보 추천 시스템 설계 및 구현에 관한 연구(한국비블리아학회지 VOL.23. NO.4 (2012):283-308,) * */ public class AssociationRule {  /** * Example : * * String metric = \"lift\"; * Float minLift = (float)1.0; * AssociationRule associationRule = new AssociationRule(apriori.getResult(), metric, minLift); // apriori initialized * associationRule.run(); */  private MapSetString, Float itemset;  private String metric;  private Float min_threshold;  private ListAssociationRuleObj rules;    public AssociationRule(MapSetString, Float itemset, String metric, Float min_threshold) {  this.itemset = itemset;  this.metric = metric;  this.min_threshold = min_threshold;  this.rules = new LinkedList();  }   public ListAssociationRuleObj getRules() {  return rules;  }   private Float scoreByMetric(String metric, Float sAC, Float sA, Float sC) {  Float score;  if (metric.equals(\"support\")) { score = getSupport(sAC); }  else if (metric.equals(\"confidence\")) { score = getConfidence(sAC, sA); }  else if(metric.equals(\"lift\")) { score = getLift(sAC, sA, sC); }  else { score = null; }   return score;  }  private Float getSupport(Float sAC) { return sAC; }  private Float getConfidence(Float sAC, Float sA) { return sAC / sA; }  private Float getLift(Float sAC, Float sA, Float sC) {  return (sAC/sA) / sC;  }  private void filterItemset() {  itemset.entrySet().removeIf(x - x.getKey().size()  2);  }   public void run() {  filterItemset();  for (SetString item : itemset.keySet()) {  Float sAC = itemset.get(item);  for (Integer idx = item.size()-1; idx  0; idx--) {  SetSetString combination = Sets.combinations(item, idx);  for (SetString comb : combination) {  SetString antecedent = comb;  SetString consequent = Sets.difference(item, comb);   Float sA = itemset.get(antecedent);  Float sC = itemset.get(consequent);  Float score = scoreByMetric(metric, sAC, sA, sC);  if (score = min_threshold) {  rules.add(new AssociationRuleObj(antecedent, consequent, sAC, getConfidence(sAC, sA), getLift(sAC, sA, sC)));  }  }  }  }  }   } AssociationRuleObj.java\nimport lombok.Getter; import java.util.Set;  /** * Apriori Algorithm implementation * @author cjlee * @see cjlee38.github.io */ @Getter public class AssociationRuleObj {  private SetString antecedent;  private SetString consequent;  private Float support;  private Float confidence;  private Float lift;   public AssociationRuleObj(SetString antecedent, SetString consequent,  Float support, Float confidence, Float lift) {  this.antecedent = antecedent;  this.consequent = consequent;  this.support = support;  this.confidence = confidence;  this.lift = lift;  } } 사용법은 코드 내에 작성하였다.\n또한, AssociationRule은 python의 mlxtend 라이브러리를 참고하였다.\n5. 활용 : 이렇게 구현한 연관 규칙을, 어떻게 활용할까?\n우리 시스템 상에서의 목적은, 연관규칙을 통해, “해당 사용자\"에게 걸맞는 “과목별 점수\"를 부여하는 것이다.\n따라서, 최소 지지도를 0.5, 향상도가 1 이상인 연관규칙에 대하여, 신뢰도를 점수로 부여하였다.\n또한, 참고논문에 근거하여, 한 itemset의 item이 2인 경우로 한정하였다.\n그 결과의 예시는 다음과 같다.(지난 발표자료에서 가져왔다.)\n{: .alignCenter}\n위와 같이 1,2,3,4의 인물이 기존 사용자로 존재한다. 그리고, 5번의 새로운 인물이 새로이 들어왔다고 해보자. 이에 대한 결과는 다음과 같다.\n{: .alignCenter}\n위와 같은 가중치를 기반으로, “수강가능 과목\"에 대한 List를 정렬한 뒤, 앞쪽에서부터 시작하여 Backtracking 기법을 활용해 시간표를 구성하고, 이를 추천하였다.\n6. 마치며 : Association Rule, Apriori의 library가 존재하기는 하지만, 대부분 Database와 연동해서 가져오는 것으로 보았다.\n또한, 우리 입맛에 맞게 Customizing을 할 수 없었기 때문에, 직접 구현하는.. 사서 고생을 했다.\n또한, “가중치\"라는 결과로 내뱉기 위한 metric을 어떻게 설정할 것인가에 대해서도 팀원과 논의하면서 어려움을 좀 겪었다.\n혹여나 이 글, 그리고 이러한 방법론이 누군가에게 도움이 된다면 뿌듯하겠다.\nReference  https://ratsgo.github.io/machine%20learning/2017/04/08/apriori/ https://rfriend.tistory.com/191 김용, Apriori 알고리즘 기반의 개인화 정보 추천 시스템 설계 및 구현에 관한 연구\n한국비블리아학회지 VOL.23. NO.4 (2012):283-308  ","wordCount":"1734","inLanguage":"en","datePublished":"2020-08-30T22:31:00Z","dateModified":"2020-08-30T22:31:00Z","author":{"@type":"Person","name":"cjlee38"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://cjlee38.github.io/post/data/data_mining/2020-08-30-association_rule_with_java/"},"publisher":{"@type":"Organization","name":"cjlee38","logo":{"@type":"ImageObject","url":"http://cjlee38.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://cjlee38.github.io/ accesskey=h title="Home (Alt + H)"><img src=http://cjlee38.github.io/assets/icon.jpeg alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://cjlee38.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=http://cjlee38.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://cjlee38.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://cjlee38.github.io/post/>Posts</a></div><h1 class=post-title># Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm )</h1><div class=post-meta><span title="2020-08-30 22:31:00 +0000 UTC">August 30, 2020</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;cjlee38&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/Data/Data_Mining/2020-08-30-association_rule_with_java.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0 aria-label="0. 들어가며">0. 들어가며</a></li><li><a href=#1-%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%ec%9d%b4%eb%9e%80 aria-label="1. 연관규칙이란?">1. 연관규칙이란?</a></li><li><a href=#2-%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%ec%9d%98-%ed%8f%89%ea%b0%80%ec%b2%99%eb%8f%84 aria-label="2. 연관규칙의 평가척도">2. 연관규칙의 평가척도</a><ul><ul><li><a href=#1-%ec%a7%80%ec%a7%80%eb%8f%84support aria-label="1) 지지도(Support)">1) 지지도(Support)</a></li><li><a href=#2-%ec%8b%a0%eb%a2%b0%eb%8f%84confidence aria-label="2) 신뢰도(Confidence)">2) 신뢰도(Confidence)</a></li><li><a href=#3-%ed%96%a5%ec%83%81%eb%8f%84lift aria-label="3) 향상도(Lift)">3) 향상도(Lift)</a></li></ul></ul></li><li><a href=#3-apriori-algorithm aria-label="3. Apriori Algorithm">3. Apriori Algorithm</a><ul><ul><li><a href=#1-assocation-rule-as-vanilla aria-label="1) Assocation Rule as Vanilla">1) Assocation Rule as Vanilla</a></li><li><a href=#2-association-rule-with-apriori-algorithm aria-label="2) Association Rule with Apriori Algorithm">2) Association Rule with Apriori Algorithm</a></li></ul></ul></li><li><a href=#4-%ec%bd%94%eb%93%9c%eb%a1%9c-%ea%b5%ac%ed%98%84%ed%95%b4%eb%b3%b4%ec%9e%90 aria-label="4. 코드로 구현해보자.">4. 코드로 구현해보자.</a></li><li><a href=#5-%ed%99%9c%ec%9a%a9 aria-label="5. 활용">5. 활용</a></li><li><a href=#6-%eb%a7%88%ec%b9%98%eb%a9%b0 aria-label="6. 마치며">6. 마치며</a><ul><ul><li><a href=#reference aria-label=Reference>Reference</a></li></ul></ul></li></ul></div></details></div><div class=post-content><h1 id=0-들어가며>0. 들어가며<a hidden class=anchor aria-hidden=true href=#0-들어가며>#</a></h1><p>: 2020년 1학기에 수강했던 종합설계 과목에서, 우리 조의 주제는 &ldquo;시간표 추천 시스템&rdquo; 이었다.</p><p>본인이 원하는 공강시간, 학점 범위, 그리고 내가 미리 골라놓은 듣고자 하는 수업을 선택하면, 이전에 내가 수강했던 과목들을 기반으로 &ldquo;남는 시간에, 이걸 듣는건 어때?&rdquo; 라는 개념으로 시간표를 구성해서, 제공해주는 시스템을 제작하고자 하였다.</p><p>그 과정에서, &ldquo;비즈니스프로그래밍2&rdquo; 수업에서 배웠던 &ldquo;연관규칙"을 활용할 수 있을 것이라 판단했고, 이에 대해서 공부하기 시작하였다.</p><h1 id=1-연관규칙이란>1. 연관규칙이란?<a hidden class=anchor aria-hidden=true href=#1-연관규칙이란>#</a></h1><p>: 흔히, 장바구니 분석이라고도 한다. 경영학을 전공하고 있는 사람이라면, 마케팅 수업에서 <strong>&ldquo;맥주를 사는 사람은 대개 기저귀도 같이 산다&rdquo;(혹은 반대로, 기저귀를 사는 사람은 대개 맥주도 사더라)</strong> 라는 이야기를 들어본 적이 있을 것이다.</p><p>전혀 연관이 없어 보이는 두 item이 왜 자주 같이 등장하는가? 를 살펴봤더니, 퇴근한 아빠가 집에서 아이를 돌보던 엄마로부터 &ldquo;기저귀좀 사와라&rdquo; 라는 말에 마트를 들리면서, 겸사겸사 맥주도 한 캔 산다는 이야기다.</p><p>즉, <strong>&ldquo;하나의 item을 샀을 때, 다른 item이 얼마나 자주 등장하는가?&rdquo;</strong> 를 다루는게 연관규칙 분석이다.</p><p>조금 어려운 말로는, <strong>&ldquo;연관규칙은 데이터베이스에서 Transaction(거래)의 동시출현성향에 대한 관계성을 표현한다&rdquo;</strong> 고 한다.</p><hr><blockquote><p>Note. Transaction 이란?<br>Transaction이란 &ldquo;하나의 거래"를 의미한다. 위 예시에서는, &ldquo;맥주와 기저귀를 구매한 이력"이 된다.<br>달리 말하면, 하나의 영수증이 Transaction이 된다.</p></blockquote><hr><h1 id=2-연관규칙의-평가척도>2. 연관규칙의 평가척도<a hidden class=anchor aria-hidden=true href=#2-연관규칙의-평가척도>#</a></h1><p>: 그렇다면, 단순하게 &ldquo;A를 샀을 때, B가 자주 등장한다&rdquo; 면, 이를 무조건 연관지어서 생각할 수 있을까? 이를 평가하는 방법에는 여러가지가 있을 것이다.</p><p>이를 찾아보면 정말 다양한 분석 기법이 있지만, 이번 포스팅에서는 이 평가 척도를 <strong>&ldquo;지지도(Support), 신뢰도(Confidence), 향상도(Lift)&rdquo;</strong> 의 세가지만 다룬다.</p><h3 id=1-지지도support>1) 지지도(Support)<a hidden class=anchor aria-hidden=true href=#1-지지도support>#</a></h3><p>: 먼저, 지지도란 물건 X와 Y가 있을 때, **&ldquo;X와 Y가 동시에 등장하는 비율&rdquo;**을 의미한다. 가령, 전체 거래수가 1,000 건인데, 이 중에서 X와 Y가 동시에 등장하는 횟수가 200이라면, Support는 20%, 즉 0.2 가 된다.</p><p>따라서, Support의 범위는 0 부터 1까지가 된다.</p><hr><blockquote><p>Note 1. 간혹, Support를 &ldquo;단순등장횟수"로, 즉 위 예시라면 200으로 표현하는 경우도 있긴 한데, 이는 비즈니스 전문가가 판단할 영역이라고 본다.</p><p>그러나, 내가 진행하는 시간표 추천 시스템은 새로이 제작하는 시스템이고, 이 이용자의 수를 측정할 수 없기 때문에, 전체 Transaction 수로 나누어주었다.</p></blockquote><hr><blockquote><p>Note 2. &ldquo;다른 물건과의 비교"가 필요한 다른 평가 척도와 달리, Support는 단독으로 측정될 수도 있다.<br>즉, 물건 X에 대한 Support, 물건 Y에 대한 Support를 따로 구할 수 있다.</p></blockquote><hr><h3 id=2-신뢰도confidence>2) 신뢰도(Confidence)<a hidden class=anchor aria-hidden=true href=#2-신뢰도confidence>#</a></h3><p>: 다음으로, 신뢰도란, 물건 X와 Y가 있을 때, <strong>&ldquo;X를 구매한 Transaction 중, Y가 얼마나 포함되는가?&rdquo;</strong> 를 이야기 한다.</p><p>즉, 전체 Transaction이 1,000 건인데, X를 구매한 Transaction이 200건이고, 이 중 Y가 포함된 거래가 100건이라면, 100/200 인 0.5가 된다.</p><p>따라서, Support와 마찬가지로 Range는 0부터 1까지가 된다.</p><hr><blockquote><p>Note. 위와 같이 &ldquo;X를 구매했을 때, Y를 얼마나 구매한다.&rdquo; 라고 할 때,<br>&ldquo;X를 구매했을 때&rdquo; 부분을 조건절(Antecedent)<br>&ldquo;Y를 얼마나 구매한다&rdquo; 부분을 결과절(Consequent) 이라고 칭한다.</p></blockquote><hr><h3 id=3-향상도lift>3) 향상도(Lift)<a hidden class=anchor aria-hidden=true href=#3-향상도lift>#</a></h3><p>: 마지막으로 향상도란, 물건 X와 Y가 있을 때, &ldquo;Y가 없을 때 X를 구매한 횟수 vs Y가 있을 때 X를 구매한 횟수&rdquo; 가 된다. 팀원은 이를 기울기로 비유했다.</p><p>마찬가지로, 전체 Transaction이 1,000 건인데, X를 구매한 Transaction이 200건, Y를 구매한 Transaction이 400건이라고 해보자.<br>이 때, Y를 구매했을 때 X가 50건, Y를 구매하지 않았을 때 X가 150건이라면,</p><p>((50/1000) / (200/1000) * (400/1000)) = (0.05 / 0.08) = 0.625가 된다.</p><p>따라서, Lift 값이 1이라는 것은 서로 연관이 없다는 것을 의미한다.</p><p>이를 수식으로 표현하면 다음과 같다.</p><p><img loading=lazy src=/assets/images/2020-08-30-22-19-25_datamining_1.md.png alt=assess>
{: .alignCenter}</p><p>이러한 평가 척도는 비즈니스 전문가가 이를 섞어서 사용한다. 즉, 상황에 맞춰서 여러 평가척도를 결합하여 활용해야 한다는 것이다.</p><p>가령, 무조건 신뢰도가 높은 itemset만을 활용한다면, 전체 Transaction에서 얼마 등장하지도 않은(극단적으로, 한 번만 등장한) itemset에 대해서 유의미하다고 판단할 것이다.</p><p>혹은, 높은 지지도, 낮은 신뢰도의 itemset에 집중하는 것이, 낮은 지지도, 높은 신뢰도의 itemset에 집중하는 것 보다 더욱 높은 수익을 안겨줄 수도 있다.</p><h1 id=3-apriori-algorithm>3. Apriori Algorithm<a hidden class=anchor aria-hidden=true href=#3-apriori-algorithm>#</a></h1><h3 id=1-assocation-rule-as-vanilla>1) Assocation Rule as Vanilla<a hidden class=anchor aria-hidden=true href=#1-assocation-rule-as-vanilla>#</a></h3><p>: 위와 같이 평가척도가 존재하는 것을 알았다. 그렇다면, 이에 대해서 연관규칙을 분석 하려면 얼마나 많은 경우의 수가 생길까?</p><p>가령, 다루고 있는 item이 A,B,C,D의 4개가 있다고 해보자. 그러면, 이에 대한 집합은<br>Level 1. [(A),(B),(C),(D)] &ndash;> 4개<br>Level 2. [(A,B), (A,C), (A,D), (B,C), (B,D), (C,D)] &ndash;> 6개<br>Level 3. [(A,B,C), (A,B,D), (A,C,D), (B,C,D)] &ndash;> 4개<br>Level 4. [(A,B,C,D)] &ndash;> 1개</p><p>총 15개, 즉 24 -1 개가 생긴다.
다루고 있는 item이 10개만 되더라도 210-1 , 즉 1023개가 생긴다.</p><hr><blockquote><p>Note. (A), (B), (C) &mldr; (A,B,C,D)와 같은 집합을, 연관규칙에선 항목집합(Itemset) 이라고 부른다.</p></blockquote><hr><p>또한, 이 Itemset들에 대한 연관규칙을 분석하는 것도 상당히 많다.<br>가령, (A,B,C) 라는 항목집합에 대해서 Confidence를 구한다고 생각해보자.</p><p>조건절 A & 결과절 B,C<br>조건절 B & 결과절 A,C<br>조건절 C & 결과절 A,B</p><p>즉, A를 구매했을 때, B,C 가 같이 구매될 확률을 구하는 것이다.</p><p>앞서, 2n -1 개의 경우의 수에, 위와 같은 경우의 수가 추가된다면, 이를 계산하는 것은 대단한 미친짓이다.</p><p><a href="https://rfriend.tistory.com/192?category=706118">여기</a>를 참고하면, 이러한 Rule의 개수는 3n-2n+1+1 개가 된다고 한다.</p><h3 id=2-association-rule-with-apriori-algorithm>2) Association Rule with Apriori Algorithm<a hidden class=anchor aria-hidden=true href=#2-association-rule-with-apriori-algorithm>#</a></h3><p>: 위와 같은 참사가 발생하는 것을 막기 위해, Apriori Algorithm이 고안되었다.</p><hr><blockquote><p>Note 1. 연관규칙에서, 연산을 줄이는 전략은 Apriori Algorithm뿐만이 아니라, FP-growth, DHP 등의 다른 알고리즘이 있다. 그러나, Apriori의 장점은, 구현하기가 용이하고, 다른 사람에게 설명하기 좋다는 장점이 있다.</p></blockquote><hr><blockquote><p>Note 2. Apriori Algorithm과 Association Rule을 동일시하는 글도 본 적이 있는데, 내가 봤을 때에는 엄연히 다르다. Association Rule은 여러 평가 척도를 기반으로 한 분석 기법이고, Apriori는 Association Rule의 비효율성을 방지하기 위한 Algorithm이다.</p></blockquote><hr><p>이 알고리즘은 &ldquo;한 항목이 비빈발(infrequent)집합이라면, 이 항목집합(subset)을 포함하는 모든 항목집합(superset)은 비빈발 항목집합이다&rdquo; 라는 원칙을 갖고 있다.</p><p>무슨말이냐 하면, 위와 같은 A,B,C,D 의 예시에서, 만약 (A) 라는 Itemset이 자주 등장하지 않는다면, 이 (A) 를 포함하는 Itemset[ (A,B), (A,C) &mldr; (A,B,C,D) ]은 쳐다보지도 않는 것이다.</p><p>또한, (A)와 같은 단일항목집합에만 해당하는 것이 아니고, (A,B)와 같은 여러개의 item을 포함하고 있는 Itemset에서 출발할 수도 있다.</p><p>그렇다면, 비빈발(infrequent)의 기준은 어떻게 정할까? 이 또한 비즈니스 전문가가 정한다. 이를 <strong>&ldquo;최소지지도&rdquo;</strong> 라 한다.
(어찌보면, 도메인 지식을 갖고 있는 사람이 이 기준을 정하는 것은 당연하기도 하다.)<br>그러나, <strong>&ldquo;통상적&rdquo;</strong> 으로, 0.5를 기준으로 둔다고 <strong>&ldquo;카더라.&rdquo;</strong></p><p>따라서, Apriori 알고리즘의 순서는 다음과 같다.</p><ol><li>최소 지지도는 0.5 이다.</li><li>Level.1의 Itemset[(A),(B),(C),(D)]를 만든다. (이를 C1 이라 한다.)</li><li>Level.1 에서, 최소지지도를 만족하지 못하는 Itemset을 <strong>쳐낸다.</strong> 여기선, <strong>A와 B가 살아남았다</strong>고 해보자.</li><li>다음으로, 살아남은 녀석들에 대한 Level.2 의 Itemset [(A,B), (A,C), (A,D), (B,C), (B,D)] 를 만든다. (C2)</li><li>Level.2에서, 최소지지도를 만족하지 못하는 Itemset을 <strong>쳐낸다.</strong></li><li>Level이 item의 개수(A,B,C,D의 4개)가 될 때까지 계속해서 반복.</li></ol><p>이를 그림으로 표현하면 다음과 같다.</p><p><img loading=lazy src=/assets/images/2020-08-30-23-31-35_2020-08-30-datamining_1.md.png alt=apriori>
{: .alignCenter}</p><p><a href="https://blog.naver.com/winipe/150162405537?proxyReferer=https%3A%2F%2Fwww.google.com%2F">사진 출처</a></p><p>위 그림에서, 우리가 앞으로 &ldquo;연관규칙분석 할 대상"은 L1, L2, L3 이다.</p><h1 id=4-코드로-구현해보자>4. 코드로 구현해보자.<a hidden class=anchor aria-hidden=true href=#4-코드로-구현해보자>#</a></h1><p>: 자바에 익숙치 않아, 클래스 설계를 이렇게 하는 것이 맞는지는 모르겠다.</p><p>Apriori.java</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.google.common.collect.Sets<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apriori Algorithm implementation 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author  cjlee
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see     cjlee38.github.io
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Apriori</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Example :
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Set&lt;Set&lt;String&gt;&gt; transactions = getTransactions(); // superset : set of transactions, subset : set of items
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Float minSupport = (float) 0.5;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Apriori apriori = new Apriori(minSupport, transactions)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * apriori.run();
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float minSupport<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> dataset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Apriori</span><span style=color:#f92672>(</span>Float minSupport<span style=color:#f92672>,</span> Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> dataset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>minSupport</span> <span style=color:#f92672>=</span> minSupport<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataset</span> <span style=color:#f92672>=</span> dataset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getResult</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> itemset <span style=color:#f92672>=</span> createSet<span style=color:#f92672>(</span>dataset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Integer level <span style=color:#f92672>=</span> 1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Integer maxLevel <span style=color:#f92672>=</span> itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>level <span style=color:#f92672>&lt;</span> maxLevel<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> combinations <span style=color:#f92672>=</span> getCombinations<span style=color:#f92672>(</span>itemset<span style=color:#f92672>,</span> level<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> supportedItemset <span style=color:#f92672>=</span> getSupportedItemset<span style=color:#f92672>(</span>combinations<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            result<span style=color:#f92672>.</span><span style=color:#a6e22e>putAll</span><span style=color:#f92672>(</span>supportedItemset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            itemset <span style=color:#f92672>=</span> createSet<span style=color:#f92672>(</span>supportedItemset<span style=color:#f92672>.</span><span style=color:#a6e22e>keySet</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            level<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>&lt;=</span> 1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// means current itemsets are all pruned
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getCombinations</span><span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> set<span style=color:#f92672>,</span> Integer level<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Sets<span style=color:#f92672>.</span><span style=color:#a6e22e>combinations</span><span style=color:#f92672>(</span>set<span style=color:#f92672>,</span> level<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 중복없는 데이터를 구하는 함수
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>createSet</span><span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> set <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashSet<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> transaction <span style=color:#f92672>:</span> data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span> String item <span style=color:#f92672>:</span> transaction<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                set<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> set<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Float <span style=color:#a6e22e>calcSupport</span><span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> itemset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Integer occurence <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span> Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> transaction <span style=color:#f92672>:</span> dataset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>transaction<span style=color:#f92672>.</span><span style=color:#a6e22e>containsAll</span><span style=color:#f92672>(</span>itemset<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                occurence<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> occurence <span style=color:#f92672>/</span> <span style=color:#f92672>((</span><span style=color:#66d9ef>float</span><span style=color:#f92672>)</span>dataset<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getSupportedItemset</span><span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> itemset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> comb <span style=color:#f92672>:</span> itemset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Float support <span style=color:#f92672>=</span> calcSupport<span style=color:#f92672>(</span>comb<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>support <span style=color:#f92672>&gt;</span> minSupport<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>comb<span style=color:#f92672>,</span> support<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> map<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>AssociationRule.java</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.google.common.collect.Sets<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>* 참고문헌
</span></span></span><span style=display:flex><span><span style=color:#75715e>* Association Rule implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e>* @author  cjlee
</span></span></span><span style=display:flex><span><span style=color:#75715e>* @see     cjlee38.github.io
</span></span></span><span style=display:flex><span><span style=color:#75715e>* @refer   김용, Apriori 알고리즘 기반의 개인화 정보 추천 시스템 설계 및 구현에 관한 연구(한국비블리아학회지 VOL.23. NO.4 (2012):283-308,)
</span></span></span><span style=display:flex><span><span style=color:#75715e>* */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AssociationRule</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Example : 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * String metric = &#34;lift&#34;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Float minLift = (float)1.0;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * AssociationRule associationRule = new AssociationRule(apriori.getResult(), metric, minLift); // apriori initialized
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * associationRule.run();
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> itemset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String metric<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float min_threshold<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>AssociationRuleObj<span style=color:#f92672>&gt;</span> rules<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>AssociationRule</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;,</span> Float<span style=color:#f92672>&gt;</span> itemset<span style=color:#f92672>,</span> String metric<span style=color:#f92672>,</span> Float min_threshold<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>itemset</span> <span style=color:#f92672>=</span> itemset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>metric</span> <span style=color:#f92672>=</span> metric<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>min_threshold</span> <span style=color:#f92672>=</span> min_threshold<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>rules</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>AssociationRuleObj<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getRules</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rules<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float <span style=color:#a6e22e>scoreByMetric</span><span style=color:#f92672>(</span>String metric<span style=color:#f92672>,</span> Float sAC<span style=color:#f92672>,</span> Float sA<span style=color:#f92672>,</span> Float sC<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Float score<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>metric<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;support&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> score <span style=color:#f92672>=</span> getSupport<span style=color:#f92672>(</span>sAC<span style=color:#f92672>);</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>metric<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;confidence&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> score <span style=color:#f92672>=</span> getConfidence<span style=color:#f92672>(</span>sAC<span style=color:#f92672>,</span> sA<span style=color:#f92672>);</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>metric<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;lift&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> score <span style=color:#f92672>=</span> getLift<span style=color:#f92672>(</span>sAC<span style=color:#f92672>,</span> sA<span style=color:#f92672>,</span> sC<span style=color:#f92672>);</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span> score <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float <span style=color:#a6e22e>getSupport</span><span style=color:#f92672>(</span>Float sAC<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>return</span> sAC<span style=color:#f92672>;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float <span style=color:#a6e22e>getConfidence</span><span style=color:#f92672>(</span>Float sAC<span style=color:#f92672>,</span> Float sA<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>return</span> sAC <span style=color:#f92672>/</span> sA<span style=color:#f92672>;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float <span style=color:#a6e22e>getLift</span><span style=color:#f92672>(</span>Float sAC<span style=color:#f92672>,</span> Float sA<span style=color:#f92672>,</span> Float sC<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>sAC<span style=color:#f92672>/</span>sA<span style=color:#f92672>)</span> <span style=color:#f92672>/</span> sC<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>filterItemset</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>removeIf</span><span style=color:#f92672>(</span>x <span style=color:#f92672>-&gt;</span> x<span style=color:#f92672>.</span><span style=color:#a6e22e>getKey</span><span style=color:#f92672>().</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> 2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        filterItemset<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> item <span style=color:#f92672>:</span> itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>keySet</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Float sAC <span style=color:#f92672>=</span> itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Integer idx <span style=color:#f92672>=</span> item<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()-</span>1<span style=color:#f92672>;</span> idx <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>;</span> idx<span style=color:#f92672>--)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Set<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> combination <span style=color:#f92672>=</span> Sets<span style=color:#f92672>.</span><span style=color:#a6e22e>combinations</span><span style=color:#f92672>(</span>item<span style=color:#f92672>,</span> idx<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> comb <span style=color:#f92672>:</span> combination<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> antecedent  <span style=color:#f92672>=</span> comb<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> consequent <span style=color:#f92672>=</span> Sets<span style=color:#f92672>.</span><span style=color:#a6e22e>difference</span><span style=color:#f92672>(</span>item<span style=color:#f92672>,</span> comb<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    Float sA <span style=color:#f92672>=</span> itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>antecedent<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    Float sC <span style=color:#f92672>=</span> itemset<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>consequent<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    Float score <span style=color:#f92672>=</span> scoreByMetric<span style=color:#f92672>(</span>metric<span style=color:#f92672>,</span> sAC<span style=color:#f92672>,</span> sA<span style=color:#f92672>,</span> sC<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>score <span style=color:#f92672>&gt;=</span> min_threshold<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        rules<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AssociationRuleObj<span style=color:#f92672>(</span>antecedent<span style=color:#f92672>,</span> consequent<span style=color:#f92672>,</span> sAC<span style=color:#f92672>,</span> getConfidence<span style=color:#f92672>(</span>sAC<span style=color:#f92672>,</span> sA<span style=color:#f92672>),</span> getLift<span style=color:#f92672>(</span>sAC<span style=color:#f92672>,</span> sA<span style=color:#f92672>,</span> sC<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>AssociationRuleObj.java</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> lombok.Getter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Set<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apriori Algorithm implementation 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author  cjlee
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see     cjlee38.github.io
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Getter</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AssociationRuleObj</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> antecedent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> consequent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float support<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float confidence<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Float lift<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>AssociationRuleObj</span><span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> antecedent<span style=color:#f92672>,</span> Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> consequent<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                              Float support<span style=color:#f92672>,</span> Float confidence<span style=color:#f92672>,</span> Float lift<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>antecedent</span> <span style=color:#f92672>=</span> antecedent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>consequent</span> <span style=color:#f92672>=</span> consequent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>support</span> <span style=color:#f92672>=</span> support<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>confidence</span> <span style=color:#f92672>=</span> confidence<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>lift</span> <span style=color:#f92672>=</span> lift<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>사용법은 코드 내에 작성하였다.<br>또한, AssociationRule은 python의 mlxtend 라이브러리를 참고하였다.</p><h1 id=5-활용>5. 활용<a hidden class=anchor aria-hidden=true href=#5-활용>#</a></h1><p>: 이렇게 구현한 연관 규칙을, 어떻게 활용할까?</p><p>우리 시스템 상에서의 목적은, 연관규칙을 통해, &ldquo;해당 사용자"에게 걸맞는 &ldquo;과목별 점수"를 부여하는 것이다.<br>따라서, 최소 지지도를 0.5, 향상도가 1 이상인 연관규칙에 대하여, 신뢰도를 점수로 부여하였다.</p><p>또한, <a href="https://academic.naver.com/article.naver?doc_id=56754379">참고논문</a>에 근거하여, 한 itemset의 item이 2인 경우로 한정하였다.</p><p>그 결과의 예시는 다음과 같다.(지난 발표자료에서 가져왔다.)</p><p><img loading=lazy src=/assets/images/2020-08-31-00-21-10_2020-08-30-datamining_1.md.png alt=1>
{: .alignCenter}</p><p>위와 같이 1,2,3,4의 인물이 기존 사용자로 존재한다. 그리고, <strong>5번의 새로운 인물이 새로이 들어왔다</strong>고 해보자. 이에 대한 결과는 다음과 같다.</p><p><img loading=lazy src=/assets/images/2020-08-31-00-22-10_2020-08-30-datamining_1.md.png alt=2>
{: .alignCenter}</p><p>위와 같은 가중치를 기반으로, &ldquo;수강가능 과목"에 대한 List를 정렬한 뒤, 앞쪽에서부터 시작하여 Backtracking 기법을 활용해 시간표를 구성하고, 이를 추천하였다.</p><h1 id=6-마치며>6. 마치며<a hidden class=anchor aria-hidden=true href=#6-마치며>#</a></h1><p>: Association Rule, Apriori의 library가 존재하기는 하지만, 대부분 Database와 연동해서 가져오는 것으로 보았다.<br>또한, 우리 입맛에 맞게 Customizing을 할 수 없었기 때문에, 직접 구현하는.. 사서 고생을 했다.</p><p>또한, &ldquo;가중치"라는 결과로 내뱉기 위한 metric을 어떻게 설정할 것인가에 대해서도 팀원과 논의하면서 어려움을 좀 겪었다.<br>혹여나 이 글, 그리고 이러한 방법론이 누군가에게 도움이 된다면 뿌듯하겠다.</p><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><ul><li><a href=https://ratsgo.github.io/machine%20learning/2017/04/08/apriori/>https://ratsgo.github.io/machine%20learning/2017/04/08/apriori/</a></li><li><a href=https://rfriend.tistory.com/191>https://rfriend.tistory.com/191</a></li><li>김용, Apriori 알고리즘 기반의 개인화 정보 추천 시스템 설계 및 구현에 관한 연구<br>한국비블리아학회지 VOL.23. NO.4 (2012):283-308</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://cjlee38.github.io/tags/null/>null</a></li></ul><nav class=paginav><a class=prev href=http://cjlee38.github.io/post/algorithm/problem_solving/2020-09-03-problem_solving_5/><span class=title>« Prev Page</span><br><span># 프로그래머스[Lv.2] - 오픈채팅방 ( java )</span></a>
<a class=next href=http://cjlee38.github.io/post/algorithm/problem_solving/2020-08-29-problem_solving_4/><span class=title>Next Page »</span><br><span># 프로그래머스[Lv.2] - 올바른 괄호 ( java )</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on twitter" href="https://twitter.com/intent/tweet/?text=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29&url=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f&hashtags=null"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f&title=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29&summary=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29&source=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f&title=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on whatsapp" href="https://api.whatsapp.com/send?text=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29%20-%20http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share # Java로 구현하는 연관규칙분석(Association Rule) ( feat. Apriori Algorithm ) on telegram" href="https://telegram.me/share/url?text=%23%20Java%eb%a1%9c%20%ea%b5%ac%ed%98%84%ed%95%98%eb%8a%94%20%ec%97%b0%ea%b4%80%ea%b7%9c%ec%b9%99%eb%b6%84%ec%84%9d%28Association%20Rule%29%20%28%20feat.%20Apriori%20Algorithm%20%29&url=http%3a%2f%2fcjlee38.github.io%2fpost%2fdata%2fdata_mining%2f2020-08-30-association_rule_with_java%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=http://cjlee38.github.io/>cjlee38</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>